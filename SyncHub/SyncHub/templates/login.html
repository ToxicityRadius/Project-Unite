<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log In - PROJECT UNITE</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
      /* Override to ensure login inputs expand to available form width */
      .figma-login-left .figma-login-form { max-width: 100% !important; width: 100% !important; }
      .figma-login-form { max-width: 100% !important; width: 100% !important; }
      .figma-form-input { max-width: 48rem !important; width: 100% !important; padding: 1rem 2.6rem !important; box-sizing: border-box; }
      .figma-login-button { min-width: 9rem !important; }
    </style>
</head>
<body>
    <!-- Background Design -->
    <div class="background-design">
        <img src="https://api.builder.io/api/v1/image/assets/TEMP/69e5a03207d72e05249171283d6b3fef53da98b7?width=3356" alt="" class="bg-logo-1">
        <img src="https://api.builder.io/api/v1/image/assets/TEMP/5bae535a77c2066496e68aa5ed0ea8132703a86a?width=4062" alt="" class="bg-logo-2">
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <a href="{% url 'landing' %}"><i class="fas fa-id-card" style="font-size: 24px; color: var(--primary-blue); margin-right: 10px;"></i></a>
        <ul class="nav-links">
            <li><a href="{% url 'landing' %}"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="{% url 'dashboard' %}"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>

            <li><a href="{% url 'inventory:item_list' %}"><i class="fas fa-boxes"></i> Inventory</a></li>
            <li><a href="{% url 'rfid_login:login' %}"><i class="fas fa-id-card"></i> RFID Login</a></li>

        </ul>
    </nav>

    <!-- Login Content -->
    <main class="figma-login-container fade-in">
        <div class="figma-login-card">
            <!-- Left Panel - Blue with form -->
            <div class="figma-login-left">
                <div class="figma-login-welcome">welcome</div>
                <h1 class="figma-login-title">PROJECT UNITE</h1>
                <p class="figma-login-subtitle">OFFICER ATTENDANCE LOGGING AND INVENTORY TRACKING</p>
                
                <form id="loginFormPage" class="figma-login-form" method="post">
                    {% csrf_token %}

                    <!-- Display Django messages -->
                    {% if messages %}
                        {% for message in messages %}
                            <div class="message message-{{ message.tags }}" style="color: {% if message.tags == 'error' %}#ff6b6b{% else %}#51cf66{% endif %}; font-size: 0.9rem; margin-bottom: 1rem; text-align: center;">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}

                    <div class="figma-input-wrapper">
                        <input
                            type="text"
                            id="login_identifier"
                            name="username"
                            placeholder="username"
                            class="figma-form-input"
                            required
                        >
                    </div>

                    <div class="figma-input-wrapper">
                        <input
                            type="password"
                            id="login_password"
                            name="password"
                            placeholder="password"
                            class="figma-form-input"
                            required
                        >
                        <button type="button" class="figma-pw-toggle" onclick="togglePassword()">��️</button>
                    </div>

                    <div class="figma-forgot-link">
                        <a href="#" id="goToResetFromLogin" class="auth-link">Forgot your password?</a>
                    </div>
                    <button type="submit" class="figma-login-button">Login</button>
                </form>

                <div class="figma-signup-prompt">
                    Don't have an account? <a href="{% url 'signup' %}" class="figma-signup-link">Sign up here</a>
                </div>
            </div>

            <!-- Right Panel - White with logo -->
            <div class="figma-login-right">
                <div class="figma-logo-container">
                    <img 
                        src="https://api.builder.io/api/v1/image/assets/TEMP/a65df8bbc0c314444292b21f3727e85bdea1974e?width=1426" 
                        alt="PROJECT UNITE Logo" 
                        class="figma-logo-image"
                    >
                </div>
            </div>
        </div>
    </main>

    {% include 'partials/auth_modal.html' %}

    <script>
        // Password toggle functionality
        function togglePassword() {
            const passwordInput = document.getElementById('login_password');
            const toggleButton = document.querySelector('.figma-pw-toggle');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16"><path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/><path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/></svg>';
            } else {
                passwordInput.type = 'password';
                toggleButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16"><path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.248-.517.486z"/><path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829"/><path d="M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12z"/></svg>';
            }
        }

        // Modal functionality
        const modal = document.querySelector('.home');
        const openSignupBtn = document.getElementById('openSignupFromLogin');
        const closeModalBtn = document.querySelector('.form_close');

        if (openSignupBtn) {
            openSignupBtn.addEventListener('click', (e) => {
                e.preventDefault();
                modal.classList.remove('hidden');
            });
        }

        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });
        }

        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
            }
        });

        // Signup form handling
        const signupForm = document.getElementById('signupForm');
        if (signupForm) {
            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = {
                    username: document.getElementById('signup_username').value,
                    email: document.getElementById('signup_email').value,
                    password: document.getElementById('signup_password').value,
                    confirm_password: document.getElementById('confirm_password').value
                };

                // Basic validation
                if (formData.password !== formData.confirm_password) {
                    alert('Passwords do not match');
                    return;
                }

                try {
                    const response = await fetch('/api/signup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });

                    const result = await response.json();
                    
                    if (response.ok) {
                        alert('Account created successfully! Please log in.');
                        modal.classList.add('hidden');
                        // Clear form
                        signupForm.reset();
                    } else {
                        alert(result.message || 'Error creating account');
                    }
                } catch (error) {
                    alert('Error creating account');
                }
            });
        }

        // Password visibility toggle for signup modal
        document.querySelectorAll('.pw_hide').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const input = this.parentElement.querySelector('input');
                if (input.type === 'password') {
                    input.type = 'text';
                    this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16"><path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/><path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/></svg>';
                } else {
                    input.type = 'password';
                    this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16"><path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.248-.517.486z"/><path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829"/><path d="M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12z"/></svg>';
                }
            });
        });
    </script>
</body>
</html>
