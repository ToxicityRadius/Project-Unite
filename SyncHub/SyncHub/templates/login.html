<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log In - PROJECT UNITE</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <!-- Background Design -->
    <div class="background-design">
        <img src="https://api.builder.io/api/v1/image/assets/TEMP/69e5a03207d72e05249171283d6b3fef53da98b7?width=3356" alt="" class="bg-logo-1">
        <img src="https://api.builder.io/api/v1/image/assets/TEMP/5bae535a77c2066496e68aa5ed0ea8132703a86a?width=4062" alt="" class="bg-logo-2">
    </div>

    <!-- Login Content -->
    <main class="figma-login-container fade-in">
        <div class="figma-login-card">
            <!-- Left Panel - Blue with form -->
            <div class="figma-login-left">
                <div class="figma-login-welcome">welcome</div>
                <h1 class="figma-login-title">PROJECT UNITE</h1>
                <p class="figma-login-subtitle">INEFFICIENT OFFICER ATTENDANCE LOGGING AND INVENTORY TRACKING</p>
                
                <form class="figma-login-form" method="post">
                    {% csrf_token %}
                    
                    <!-- Display Django messages -->
                    {% if messages %}
                        {% for message in messages %}
                            <div class="message message-{{ message.tags }}" style="color: {% if message.tags == 'error' %}#ff6b6b{% else %}#51cf66{% endif %}; font-size: 0.9rem; margin-bottom: 1rem; text-align: center;">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                    
                    <div class="figma-input-wrapper">
                        <input 
                            type="text" 
                            name="username" 
                            placeholder="username" 
                            class="figma-form-input"
                            required
                        >
                    </div>
                    
                    <div class="figma-input-wrapper">
                        <input 
                            type="password" 
                            name="password" 
                            placeholder="password" 
                            class="figma-form-input"
                            id="password-input"
                            required
                        >
                        <button type="button" class="figma-pw-toggle" onclick="togglePassword()">üëÅÔ∏è</button>
                    </div>
                    
                    <button type="submit" class="figma-login-button">Login</button>
                </form>
                
                <div class="figma-signup-prompt">
                    Don't have an account? <a href="#" id="openSignupFromLogin" class="figma-signup-link">Sign up here</a>
                </div>
            </div>
            
            <!-- Right Panel - White with logo -->
            <div class="figma-login-right">
                <div class="figma-logo-container">
                    <img 
                        src="https://api.builder.io/api/v1/image/assets/TEMP/a65df8bbc0c314444292b21f3727e85bdea1974e?width=1426" 
                        alt="PROJECT UNITE Logo" 
                        class="figma-logo-image"
                    >
                </div>
            </div>
        </div>
    </main>

    <!-- Auth Modal for Signup -->
    <div class="home hidden" style="position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:60;">
        <div class="form_container" style="background:var(--white);padding:24px;border-radius:12px;max-width:400px;width:95%;position:relative;">
            <button class="form_close" style="position:absolute;right:16px;top:16px;">Close</button>
            <!-- Signup Form -->
            <form id="signupForm" class="signup_form" style="width:100%;" aria-hidden="false">
                <h3>Sign Up</h3>
                <div style="margin-bottom:12px;"><input id="signup_username" class="form-input" placeholder="Username"></div>
                <div style="margin-bottom:12px;"><input id="signup_email" type="email" class="form-input" placeholder="Email"></div>
                <div style="margin-bottom:12px;position:relative;"><input id="signup_password" type="password" class="form-input" placeholder="Password"><span tabindex="0" class="pw_hide" style="position:absolute;right:12px;top:10px;cursor:pointer;">üëÅÔ∏è</span></div>
                <div style="margin-bottom:12px;position:relative;"><input id="confirm_password" type="password" class="form-input" placeholder="Confirm Password"><span tabindex="0" class="pw_hide" style="position:absolute;right:12px;top:10px;cursor:pointer;">üëÅÔ∏è</span></div>
                <button id="signup" class="login-button" type="submit">Sign Up Now</button>
                <p style="text-align:center;margin-top:12px;font-size:14px;">Already have an account? <a href="{% url 'login' %}" style="color:var(--primary-blue);">Log in</a></p>
            </form>
        </div>
    </div>

    <script>
        // Password toggle functionality
        function togglePassword() {
            const passwordInput = document.getElementById('password-input');
            const toggleButton = document.querySelector('.figma-pw-toggle');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                toggleButton.textContent = 'üëÅÔ∏è';
            }
        }

        // Modal functionality
        const modal = document.querySelector('.home');
        const openSignupBtn = document.getElementById('openSignupFromLogin');
        const closeModalBtn = document.querySelector('.form_close');

        if (openSignupBtn) {
            openSignupBtn.addEventListener('click', (e) => {
                e.preventDefault();
                modal.classList.remove('hidden');
            });
        }

        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });
        }

        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
            }
        });

        // Signup form handling
        const signupForm = document.getElementById('signupForm');
        if (signupForm) {
            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = {
                    username: document.getElementById('signup_username').value,
                    email: document.getElementById('signup_email').value,
                    password: document.getElementById('signup_password').value,
                    confirm_password: document.getElementById('confirm_password').value
                };

                // Basic validation
                if (formData.password !== formData.confirm_password) {
                    alert('Passwords do not match');
                    return;
                }

                try {
                    const response = await fetch('/api/signup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });

                    const result = await response.json();
                    
                    if (response.ok) {
                        alert('Account created successfully! Please log in.');
                        modal.classList.add('hidden');
                        // Clear form
                        signupForm.reset();
                    } else {
                        alert(result.message || 'Error creating account');
                    }
                } catch (error) {
                    alert('Error creating account');
                }
            });
        }

        // Password visibility toggle for signup modal
        document.querySelectorAll('.pw_hide').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const input = this.parentElement.querySelector('input');
                if (input.type === 'password') {
                    input.type = 'text';
                    this.textContent = 'üôà';
                } else {
                    input.type = 'password';
                    this.textContent = 'üëÅÔ∏è';
                }
            });
        });
    </script>
</body>
</html>
