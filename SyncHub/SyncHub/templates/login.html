<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log In - PROJECT UNITE</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <!-- Background Design -->
    <div class="background-design">
        <img src="https://api.builder.io/api/v1/image/assets/TEMP/69e5a03207d72e05249171283d6b3fef53da98b7?width=3356" alt="" class="bg-logo-1">
        <img src="https://api.builder.io/api/v1/image/assets/TEMP/5bae535a77c2066496e68aa5ed0ea8132703a86a?width=4062" alt="" class="bg-logo-2">
    </div>

    <!-- Login Content -->
    <main class="figma-login-container fade-in">
        <div class="figma-login-card">
            <!-- Left Panel - Blue with form -->
            <div class="figma-login-left">
                <div class="figma-login-welcome">welcome</div>
                <h1 class="figma-login-title">PROJECT UNITE</h1>
                <p class="figma-login-subtitle">INEFFICIENT OFFICER ATTENDANCE LOGGING AND INVENTORY TRACKING</p>
                
                <form id="loginFormPage" class="figma-login-form" method="post">
                    {% csrf_token %}

                    <!-- Display Django messages -->
                    {% if messages %}
                        {% for message in messages %}
                            <div class="message message-{{ message.tags }}" style="color: {% if message.tags == 'error' %}#ff6b6b{% else %}#51cf66{% endif %}; font-size: 0.9rem; margin-bottom: 1rem; text-align: center;">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}

                    <div class="figma-input-wrapper">
                        <input
                            type="text"
                            id="login_identifier"
                            name="username"
                            placeholder="username"
                            class="figma-form-input"
                            required
                        >
                    </div>

                    <div class="figma-input-wrapper">
                        <input
                            type="password"
                            id="login_password"
                            name="password"
                            placeholder="password"
                            class="figma-form-input"
                            required
                        >
                        <button type="button" class="figma-pw-toggle" onclick="togglePassword()">ÔøΩÔøΩÔ∏è</button>
                    </div>

                    <button type="submit" class="figma-login-button">Login</button>
                </form>

                <div class="figma-signup-prompt">
                    Don't have an account? <a href="{% url 'signup' %}" class="figma-signup-link">Sign up here</a>
                </div>
            </div>

            <!-- Right Panel - White with logo -->
            <div class="figma-login-right">
                <div class="figma-logo-container">
                    <img 
                        src="https://api.builder.io/api/v1/image/assets/TEMP/a65df8bbc0c314444292b21f3727e85bdea1974e?width=1426" 
                        alt="PROJECT UNITE Logo" 
                        class="figma-logo-image"
                    >
                </div>
            </div>
        </div>
    </main>


    <script>
        // Password toggle functionality
        function togglePassword() {
            const passwordInput = document.getElementById('password-input');
            const toggleButton = document.querySelector('.figma-pw-toggle');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                toggleButton.textContent = 'üëÅÔ∏è';
            }
        }

        // Modal functionality
        const modal = document.querySelector('.home');
        const openSignupBtn = document.getElementById('openSignupFromLogin');
        const closeModalBtn = document.querySelector('.form_close');

        if (openSignupBtn) {
            openSignupBtn.addEventListener('click', (e) => {
                e.preventDefault();
                modal.classList.remove('hidden');
            });
        }

        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });
        }

        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
            }
        });

        // Signup form handling
        const signupForm = document.getElementById('signupForm');
        if (signupForm) {
            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = {
                    username: document.getElementById('signup_username').value,
                    email: document.getElementById('signup_email').value,
                    password: document.getElementById('signup_password').value,
                    confirm_password: document.getElementById('confirm_password').value
                };

                // Basic validation
                if (formData.password !== formData.confirm_password) {
                    alert('Passwords do not match');
                    return;
                }

                try {
                    const response = await fetch('/api/signup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });

                    const result = await response.json();
                    
                    if (response.ok) {
                        alert('Account created successfully! Please log in.');
                        modal.classList.add('hidden');
                        // Clear form
                        signupForm.reset();
                    } else {
                        alert(result.message || 'Error creating account');
                    }
                } catch (error) {
                    alert('Error creating account');
                }
            });
        }

        // Password visibility toggle for signup modal
        document.querySelectorAll('.pw_hide').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const input = this.parentElement.querySelector('input');
                if (input.type === 'password') {
                    input.type = 'text';
                    this.textContent = 'üôà';
                } else {
                    input.type = 'password';
                    this.textContent = 'üëÅÔ∏è';
                }
            });
        });
    </script>
</body>
</html>
